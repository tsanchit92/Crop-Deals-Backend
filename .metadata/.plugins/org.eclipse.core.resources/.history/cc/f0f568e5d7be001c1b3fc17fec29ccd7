package farm.service;

import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.MediaType;
import org.springframework.stereotype.Service;
import org.springframework.web.reactive.function.client.WebClient;

import farm.model.Crop;
import farm.model.FarmModel;
import farm.repository.FarmRepository;
import reactor.core.publisher.Mono;

@Service
public class FarmService {

	@Autowired
	private WebClient.Builder webClientBuilder;

	@Autowired
	public FarmRepository farmRepo;

	public boolean register(FarmModel farmModel) {
		farmRepo.save(farmModel);
		return true;
	}

	public List<Crop> getFarmers() {
		List<Crop>response = webClientBuilder.build().get().uri("http://sanchitslappy:8000/farmer/getCrops")
				.accept(MediaType.APPLICATION_JSON).retrieve()
				.bodyToMono(new ParameterizedTypeReference<List<Crop>>() {}).block();
				
		
		return response;	
				
				
				
		

		
	}
	
	public void removeDealer(FarmModel farmModel)
	{
		farmRepo.deleteById(farmModel.getId());
	}

	/*
	 * public void rateFarmer(int rating) {
	 * webClientBuilder.build().post().uri("http://localhost:8000/rating")
	 * .header(HttpHeaders.CONTENT_TYPE,MediaType.APPLICATION_JSON_VALUE) .body()
	 * 
	 * 
	 * }
	 */
	

	
}
